# .envrc for Jambi project
# This file integrates with direnv to automatically load the nix-shell environment

# Use nix-shell for the development environment
use nix

# Set up Rust environment variables
export RUST_SRC_PATH="$(rustc --print sysroot 2>/dev/null)/lib/rustlib/src/rust/library" || true
export RUST_LOG="${RUST_LOG:-warn}"
export RUST_BACKTRACE=1

# Set up Vosk library paths
export VOSK_LIB_DIR="${HOME}/.cache/jambi/vosk-lib"
export LD_LIBRARY_PATH="${VOSK_LIB_DIR}:${LD_LIBRARY_PATH:-}"

# Cargo configuration
export CARGO_INCREMENTAL=1
export CARGO_NET_RETRY=10
export CARGO_BUILD_JOBS=4

# Fix for rust-analyzer sysroot issues in NixOS
if command -v rustc >/dev/null 2>&1; then
    export RUST_SYSROOT="$(rustc --print sysroot)"
fi

# Create Vosk directories if they don't exist
mkdir -p "${HOME}/.cache/jambi/vosk-lib"
mkdir -p "${HOME}/.cache/jambi/vosk-models"

# Optional: Load any local overrides
if [ -f .envrc.local ]; then
    source .envrc.local
fi

# Print environment info (comment out if too verbose)
echo "Jambi development environment loaded"
echo "  Vosk library: ${VOSK_LIB_DIR}"
echo "  Rust sysroot: ${RUST_SYSROOT:-not found}"